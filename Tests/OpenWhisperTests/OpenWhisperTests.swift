import XCTest
@testable import OpenWhisper

final class OpenWhisperTests: XCTestCase {
    func testModelSourceTitles() throws {
        XCTAssertEqual(ModelSource.bundledTiny.title, "Bundled tiny model")
        XCTAssertEqual(ModelSource.customPath.title, "Custom local model")
    }

    func testModelSourceAllCases() throws {
        let allCases = ModelSource.allCases.map { $0.title }
        XCTAssertFalse(allCases.isEmpty)
    }

    func testHotkeySupportedKeyValidation() throws {
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("space"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("F12"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("z"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("home"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("pgdn"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("pg up key"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("pg dn key"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("‚áû"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("‚áü"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("pg down"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("page down"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("f24"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("page-up"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("left arrow"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("left key"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("return key"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("esc key"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("‚êõ"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("insert"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("insert key"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("help"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("help key"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("section"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("¬ß"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("space key"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("tab key"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("home key"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("numpad0"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("kp0"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("num9"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("keypadenter"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("‚åß"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("numpad ."))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("numpad ,"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("numpad +"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("keypad -"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("globe"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("üåê"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("üåêÔ∏é"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("cmd+shift+space"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("cmd shift space"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("cmd\u{00A0}shift\u{00A0}space"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("meta+space"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("super-shift-f6"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("command-shift-page-down"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("‚åò + ‚áß + f6"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("‚åòÔºã‚áßÔºãspace"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("cmd, shift, space"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("command/shift/space"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("‚åò‚áßspace"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("‚åÉ‚å•return"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("commandshiftspace"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("ctrlaltdelete"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("return or enter"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("enter-or-return"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("backquote"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("quote left"))
        XCTAssertFalse(HotkeyDisplay.isSupportedKey(""))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("capslock"))
        XCTAssertTrue(HotkeyDisplay.isSupportedKey("caps lock"))
        XCTAssertFalse(HotkeyDisplay.isSupportedKey("foo"))
    }

    func testHotkeyCanonicalAliases() throws {
        XCTAssertEqual(HotkeyDisplay.canonicalKey("spacebar"), "space")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("space key"), "space")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("tab key"), "tab")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("‚ê£"), "space")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("enter"), "return")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("return key"), "return")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("‚Ü©"), "return")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("‚Üµ"), "return")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("‚èé"), "return")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("esc"), "escape")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("esc key"), "escape")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("‚éã"), "escape")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("‚êõ"), "escape")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("delete key"), "delete")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("backspace"), "delete")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("‚å´"), "delete")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("‚å¶"), "forwarddelete")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("insert"), "insert")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("insert key"), "insert")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("ins"), "insert")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("help"), "help")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("help key"), "help")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("section"), "section")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("¬ß"), "section")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("caps"), "capslock")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("caps lock"), "capslock")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("caps-lock"), "capslock")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("globe"), "fn")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("üåê"), "fn")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("üåêÔ∏é"), "fn")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("‚Üê"), "left")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("left arrow"), "left")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("‚Üí"), "right")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("right arrow"), "right")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("‚Üë"), "up")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("‚Üì"), "down")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("left key"), "left")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("home key"), "home")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("end key"), "end")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("page-up"), "pageup")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("pg up key"), "pageup")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("pg dn key"), "pagedown")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("‚áû"), "pageup")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("‚áü"), "pagedown")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("pg down"), "pagedown")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("page down"), "pagedown")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("numpad0"), "keypad0")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("kp0"), "keypad0")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("num9"), "keypad9")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("numpad enter"), "keypadenter")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("numpad ."), "keypaddecimal")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("numpad ,"), "keypadcomma")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("numpad +"), "keypadplus")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("numpad clear"), "keypadclear")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("clear"), "keypadclear")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("‚åß"), "keypadclear")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("keypad -"), "keypadminus")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("cmd+shift+space"), "space")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("cmd shift space"), "space")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("cmd\u{00A0}shift\u{00A0}space"), "space")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("meta+space"), "space")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("super-shift-f6"), "f6")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("command-shift-page-down"), "pagedown")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("‚åò + ‚áß + f6"), "f6")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("‚åòÔºã‚áßÔºãspace"), "space")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("cmd, shift, space"), "space")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("command/shift/space"), "space")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("‚åò‚áßspace"), "space")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("‚åÉ‚å•return"), "return")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("commandshiftspace"), "space")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("ctrlaltdelete"), "delete")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("return or enter"), "return")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("enter-or-return"), "return")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("backquote"), "backtick")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("quote left"), "backtick")
        XCTAssertEqual(HotkeyDisplay.canonicalKey("grave key"), "backtick")
    }

    func testHotkeyDisplayForKeypadKeys() throws {
        XCTAssertEqual(HotkeyDisplay.displayKey("keypad0"), "Num0")
        XCTAssertEqual(HotkeyDisplay.displayKey("numpadplus"), "Num+")
        XCTAssertEqual(HotkeyDisplay.displayKey("keypadcomma"), "Num,")
        XCTAssertEqual(HotkeyDisplay.displayKey("keypadenter"), "NumEnter")
        XCTAssertEqual(HotkeyDisplay.displayKey("return"), "Return/Enter")
        XCTAssertEqual(HotkeyDisplay.displayKey("insert"), "Insert")
        XCTAssertEqual(HotkeyDisplay.displayKey("help"), "Help")
        XCTAssertEqual(HotkeyDisplay.displayKey("section"), "¬ß")
        XCTAssertEqual(HotkeyDisplay.displayKey("fn"), "Fn/Globe")
        XCTAssertEqual(HotkeyDisplay.displayKey("equals"), "+")
    }
}